<html>
    <head>
        <title>xtag</title>
        <script src="lib/x-tag-core.min.js"></script>
		<script src="components.js"></script>
		<link rel="stylesheet" href="lib/leaflet.css" />
		<script src="lib/leaflet.js"></script>
		<style>#mapid { height: 180px; }</style>
        <script>
			xtag.register('x-map', {
				lifecycle: {
					created: function() {
						const markerList = xtag.queryChildren(this, 'x-marker');

						this.innerHTML += '<style>.leaflet-container { height: 512px; width: 512px;} </style><div></div>';
						var mymap = L.map(this.lastChild).setView([this.attributes.lat.value, this.attributes.lng.value], 13);

						markerList.forEach(function(child) {
							const marker = L.marker([child.attributes.lat.value, child.attributes.lng.value])
								.addTo(mymap)
							    .bindPopup(child.innerHTML);
						});
					}
				}
			});

			xtag.register('x-marker', {
				lifecycle: {
					created: function() {
						this.innerHTML = '<div class=".marker">i am a marker</div>';
					}
				}
			});
        </script>
    </head>
    <body>
		<x-map lat="51.505" lng="-0.09">
			<x-marker lat="51.51" lng="-0.09">
				building
			</x-marker>
			<x-marker lat="51.5" lng="-0.09">
				building
			</x-marker>
		</x-map>
    </body>
</html>
